<html>
    <head>
      <link rel="stylesheet" type="text/css" href="/chatbot/css/chatbot.css">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
      <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>

      <meta charset="utf-8" />
      <title>Chatbot</title>
    </head>

    <body>
      <div class="col-md-4 col-md-offset-4 frame">
        <ul id="message_line"></ul>
        <div>
          <div class="msj-rta macro" style="margin:auto">
            <div class="text text-r" style="background: whitesmoke !important">
              <input id="message_input" class="mytext" placeholder="Posez une question"/>
            </div>
          </div>
        </div>
      </div>

      <input type = "text" id="ville">
      <input type = "submit" value = "Envoyer" id ="bouton">

        <script src="/socket.io/socket.io.js"></script>
        <script>
          var socket = io.connect('http://localhost:8080');
          socket.on('reponse', function(reponse) {
            //insertChat("her", reponse);
          });
          socket.on('suggest', function(suggest) {
            resetSuggest();
            insertChat("suggest", suggest);
          });

          function reload_handlers() {
              $(".suggest_button").last().click(function(){
                insertChat("me", "Je voulais dire " + $(".suggest_button").last().html());
                socket.emit('message', $(".suggest_button").last().html());
              });
              $('#message_input').change(function () {
                socket.emit('attempt', $('#message_input').val());
              });
          }
          reload_handlers();

          var me = {};
          me.avatar = "/chatbot/images/avatar.jpg";
          var her = {};
          her.avatar = "/chatbot/images/avatar_prudence.jpg";

          function resetChat(){
            $("#message_line").empty();
          }

          function resetSuggest(){
            $("#message_line").last().empty();
          }

          function formatAMPM(date) {
            var hours = date.getHours();
            var minutes = date.getMinutes();
            minutes = minutes < 10 ? '0'+minutes : minutes;
            var strTime = hours + ':' + minutes;
            return strTime;
          }

          function insertChat(what, text){
            var control = "";
            var date = formatAMPM(new Date());

            if (what == "me"){
              control = '<li style="width:auto; margin-right: 5%; margin-left: 5%;">' +
                                '<div class="msj-rta macro">' +
                                '<div class="avatar"><img class="img-circle" style="width:100%;" src="'+ me.avatar +'" /></div>' +
                                    '<div class="text text-r">' +
                                        '<p>'+ text +'</p>' +
                                        '<p><small>'+date+'</small></p>' +
                                    '</div>' +
                                '</div>' +
                            '</li>';
            }else if (what == "suggest") {
              control = '<li style="width:auto; margin-right: 5%; margin-left: 5%;">' +
                                '<div class="msj macro">' +
                                    '<div class="text text-l">' +
                                        '<p>Vous voulez dire : </p>' +
                                        '<button type="button" class="btn btn-light suggest_button">'+text+'</button>' +
                                        '<p><small>'+date+'</small></p>' +
                                    '</div>' +
                                '<div class="avatar" style="padding:0px 0px 0px 10px !important"><img class="img-circle" style="width:100%;" src="'+her.avatar+'" /></div>' +
                          '</li>';
            }else if (what == "her"){
              control = '<li style="width:auto; margin-right: 5%; margin-left: 5%;">' +
                                '<div class="msj macro">' +
                                    '<div class="text text-l">' +
                                        '<p>'+text+'</p>' +
                                        '<p><small>'+date+'</small></p>' +
                                    '</div>' +
                                '<div class="avatar" style="padding:0px 0px 0px 10px !important"><img class="img-circle" style="width:100%;" src="'+her.avatar+'" /></div>' +
                          '</li>';
            }
            $("#message_line").append(control);
            reload_handlers();
          }

        </script>

    </body>
</html>
